<Window x:Class="LLWallPaper.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:LLWallPaper.App.Controls"
        Title="LLWallPaper" Height="720" Width="980"
        MinHeight="540" MinWidth="840"
        WindowStartupLocation="CenterScreen">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border BorderBrush="#DDDDDD" BorderThickness="1" Padding="12" CornerRadius="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Vertical" Grid.Column="0">
                    <TextBlock Text="Current Wallpaper" FontWeight="SemiBold"/>
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="Name: " FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding CurrentCardName}"/>
                        <TextBlock Text="   ID: " FontWeight="SemiBold" Margin="12,0,0,0"/>
                        <TextBlock Text="{Binding CurrentCardId}"/>
                        <TextBlock Text="   Source: " FontWeight="SemiBold" Margin="12,0,0,0"/>
                        <TextBlock Text="{Binding CurrentSource}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding StatusText}" Margin="0,8,0,0"/>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <Button Content="Toggle Favorite" Width="140" Margin="0,0,8,0"
                                Command="{Binding ToggleCurrentFavoriteCommand}"/>
                        <Button Content="Toggle Blocked" Width="140"
                                Command="{Binding ToggleCurrentBlockedCommand}"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button Content="Next" Width="96" Margin="0,0,8,0" Command="{Binding NextCommand}"/>
                    <Button Content="Pause/Resume" Width="120" Command="{Binding ToggleAutoCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <TabControl Grid.Row="1" Margin="0,16,0,0">
            <TabItem Header="Cards">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="0,0,8,8">
                        <TextBox Width="420" Height="20"
                                 Text="{Binding CardList.SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>
                    <Button Grid.Row="0" Grid.Column="1" Content="Fetch" Width="96" Margin="0,0,0,8"
                            Command="{Binding CardList.FetchCommand}"/>

                    <ListView x:Name="CardListView" Grid.Row="1" Grid.ColumnSpan="2" ItemsSource="{Binding CardList.Items}"
                              SelectedItem="{Binding CardList.SelectedItem}" Margin="0,0,0,8">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Width="200" DisplayMemberBinding="{Binding Id}">
                                    <GridViewColumn.Header>
                                        <GridViewColumnHeader Content="ID" Tag="Id" Click="OnCardsColumnHeaderClick"/>
                                    </GridViewColumn.Header>
                                </GridViewColumn>
                                <GridViewColumn Width="280" DisplayMemberBinding="{Binding Name}">
                                    <GridViewColumn.Header>
                                        <GridViewColumnHeader Content="Name" Tag="Name" Click="OnCardsColumnHeaderClick"/>
                                    </GridViewColumn.Header>
                                </GridViewColumn>
                                <GridViewColumn Width="80" DisplayMemberBinding="{Binding IsFavorite}">
                                    <GridViewColumn.Header>
                                        <GridViewColumnHeader Content="Favorite" Tag="IsFavorite" Click="OnCardsColumnHeaderClick"/>
                                    </GridViewColumn.Header>
                                </GridViewColumn>
                                <GridViewColumn Width="80" DisplayMemberBinding="{Binding IsBlocked}">
                                    <GridViewColumn.Header>
                                        <GridViewColumnHeader Content="Blocked" Tag="IsBlocked" Click="OnCardsColumnHeaderClick"/>
                                    </GridViewColumn.Header>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>

                    <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal">
                        <Button Content="Apply" Width="96" Margin="0,0,8,0" Command="{Binding CardList.ApplyCommand}"/>
                        <Button Content="Toggle Favorite" Width="140" Margin="0,0,8,0" Command="{Binding CardList.ToggleFavoriteCommand}"/>
                        <Button Content="Toggle Blocked" Width="140" Command="{Binding CardList.ToggleBlockedCommand}"/>
                    </StackPanel>

                    <TextBlock Grid.Row="2" Grid.Column="1" VerticalAlignment="Center"
                               Text="{Binding CardList.StatusMessage}"/>
                </Grid>
            </TabItem>

            <TabItem Header="Settings">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.ColumnSpan="2" Text="Backend" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Base URL" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Width="420" HorizontalAlignment="Left"
                                 Text="{Binding Settings.BackendBaseUrl, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Grid.Row="2" Grid.ColumnSpan="2" Text="Auto Rotate" FontWeight="SemiBold" Margin="0,16,0,8"/>
                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Auto Rotate Enabled" VerticalAlignment="Center"/>
                        <CheckBox Grid.Row="3" Grid.Column="1" IsChecked="{Binding Settings.AutoRotateEnabled}"/>
                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Interval (minutes)" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="4" Grid.Column="1" Width="160" HorizontalAlignment="Left"
                                 Text="{Binding Settings.RotateIntervalMinutes}"/>
                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Rotate on App Start" VerticalAlignment="Center"/>
                        <CheckBox Grid.Row="5" Grid.Column="1" IsChecked="{Binding Settings.RotateOnAppStart}"/>

                        <TextBlock Grid.Row="6" Grid.ColumnSpan="2" Text="Random Rules" FontWeight="SemiBold" Margin="0,16,0,8"/>
                        <TextBlock Grid.Row="7" Grid.Column="0" Text="Recent Exclude Count" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="7" Grid.Column="1" Width="160" HorizontalAlignment="Left"
                                 Text="{Binding Settings.RecentExcludeCount}"/>
                        <TextBlock Grid.Row="8" Grid.Column="0" Text="Prefer Favorites" VerticalAlignment="Center"/>
                        <CheckBox Grid.Row="8" Grid.Column="1" IsChecked="{Binding Settings.PreferFavorites}"/>
                        <TextBlock Grid.Row="9" Grid.Column="0" Text="Exclude Blocked" VerticalAlignment="Center"/>
                        <CheckBox Grid.Row="9" Grid.Column="1" IsChecked="{Binding Settings.ExcludeBlocked}"/>
                        <TextBlock Grid.Row="10" Grid.Column="0" Text="Exclude duplicated 3rd evolution" VerticalAlignment="Center"/>
                        <CheckBox Grid.Row="10" Grid.Column="1" IsChecked="{Binding Settings.ExcludeThirdEvolution}"/>

                        <TextBlock Grid.Row="11" Grid.ColumnSpan="2" Text="Startup" FontWeight="SemiBold" Margin="0,16,0,8"/>
                        <TextBlock Grid.Row="12" Grid.Column="0" Text="Start with Windows" VerticalAlignment="Center"/>
                        <CheckBox Grid.Row="12" Grid.Column="1" IsChecked="{Binding Settings.StartWithWindows}"/>
                        <TextBlock Grid.Row="13" Grid.Column="0" Text="Start minimized" VerticalAlignment="Center"/>
                        <CheckBox Grid.Row="13" Grid.Column="1" IsChecked="{Binding Settings.StartMinimized}"/>

                        <TextBlock Grid.Row="14" Grid.ColumnSpan="2" Text="Cache" FontWeight="SemiBold" Margin="0,16,0,8"/>
                        <TextBlock Grid.Row="15" Grid.Column="0" Text="Cache Max (MB)" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="15" Grid.Column="1" Width="160" HorizontalAlignment="Left"
                                 Text="{Binding Settings.CacheMaxMb}"/>

                        <TextBlock Grid.Row="16" Grid.ColumnSpan="2" Text="History" FontWeight="SemiBold" Margin="0,16,0,8"/>
                        <TextBlock Grid.Row="17" Grid.Column="0" Text="History Max Entries" VerticalAlignment="Center"/>
                        <TextBox Grid.Row="17" Grid.Column="1" Width="160" HorizontalAlignment="Left"
                                 Text="{Binding Settings.HistoryMaxEntries}"/>

                        <Button Grid.Row="18" Grid.Column="1" Content="Save Settings" Width="140" Margin="0,20,0,0"
                                HorizontalAlignment="Left" Command="{Binding Settings.SaveCommand}"/>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="History">
                <Grid Margin="12">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Orientation="Horizontal">
                            <TextBlock Text="Entries" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding History.TotalCount}" Margin="8,0,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Content="Refresh" Width="96"
                                Command="{Binding History.RefreshCommand}"/>
                    </Grid>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="360"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <ListView Grid.Column="0" ItemsSource="{Binding History.Items}"
                                  SelectedItem="{Binding History.SelectedEntry}"
                                  ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                  Margin="0,8,16,0">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Width="150" DisplayMemberBinding="{Binding At, StringFormat=yyyy-MM-dd HH:mm:ss}">
                                        <GridViewColumn.Header>
                                            <GridViewColumnHeader Content="At"/>
                                        </GridViewColumn.Header>
                                    </GridViewColumn>
                                    <GridViewColumn Width="80" DisplayMemberBinding="{Binding Key}">
                                        <GridViewColumn.Header>
                                            <GridViewColumnHeader Content="Key"/>
                                        </GridViewColumn.Header>
                                    </GridViewColumn>
                                    <GridViewColumn Width="90" DisplayMemberBinding="{Binding Result}">
                                        <GridViewColumn.Header>
                                            <GridViewColumnHeader Content="Result"/>
                                        </GridViewColumn.Header>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>

                        <StackPanel Grid.Column="1" Margin="0,8,0,0">
                            <controls:ImagePreview Width="520" Height="337" Margin="0,0,0,12"
                                                   ImagePath="{Binding History.SelectedImagePath}"/>

                            <Grid Margin="0,4,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Row="0" Grid.Column="1" Content="Copy Image" Width="120"
                                        HorizontalAlignment="Left"
                                        Command="{Binding History.CopyImageCommand}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Base Path" FontWeight="SemiBold" Margin="0,12,0,0"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding History.BasePath}" TextWrapping="Wrap" Margin="0,12,0,0"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Selected At" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                <TextBlock Grid.Row="2" Grid.Column="1"
                                           Text="{Binding History.SelectedEntry.At, StringFormat=yyyy-MM-dd HH:mm:ss}" Margin="0,8,0,0"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Selected Key" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding History.SelectedEntry.Key}" Margin="0,8,0,0"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Selected File" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding History.SelectedEntry.FileName}" Margin="0,8,0,0"/>

                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Selected Result" FontWeight="SemiBold" Margin="0,8,0,0"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding History.SelectedEntry.Result}" Margin="0,8,0,0"/>
                            </Grid>
                        </StackPanel>
                    </Grid>

                    <TextBlock Grid.Row="2" VerticalAlignment="Center"
                               Text="{Binding History.StatusMessage}"/>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
